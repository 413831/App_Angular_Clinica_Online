!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/fire"),require("firebase/database")):"function"==typeof define&&define.amd?define("@angular/fire/database",["exports","@angular/core","rxjs","rxjs/operators","@angular/fire","firebase/database"],n):n(((e=e||self).angular=e.angular||{},e.angular.fire=e.angular.fire||{},e.angular.fire.database={}),e.ng.core,e.rxjs,e.rxjs.operators,e.angular.fire)}(this,(function(e,n,r,t,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function u(e,n){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var t,a,u=r.call(e),i=[];try{for(;(void 0===n||n-- >0)&&!(t=u.next()).done;)i.push(t.value)}catch(e){a={error:e}}finally{try{t&&!t.done&&(r=u.return)&&r.call(u)}finally{if(a)throw a.error}}return i}function i(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(u(arguments[n]));return e}function o(e){return null==e}function s(e){return"function"==typeof e.set}function c(e,n){return s(n)?n:e.ref(n)}function f(e,n){if("string"==typeof e)return n.stringCase();if(s(e))return n.firebaseCase();if(function(e){return"function"==typeof e.exportVal}(e))return n.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof e)}function l(e,n,a,u){return void 0===a&&(a="on"),void 0===u&&(u=r.asyncScheduler),new r.Observable((function(r){var t;return t=e[a](n,(function(e,n){u.schedule((function(){r.next({snapshot:e,prevKey:n})})),"once"==a&&u.schedule((function(){return r.complete()}))}),(function(e){u.schedule((function(){return r.error(e)}))})),"on"==a?{unsubscribe:function(){null!=t&&e.off(n,t)}}:{unsubscribe:function(){}}})).pipe(t.map((function(e){var r=e.snapshot,t=e.prevKey,a=null;return r.exists()&&(a=r.key),{type:n,payload:r,prevKey:t,key:a}})),t.share())}function p(e,n,a){return l(e,"value","once",a).pipe(t.switchMap((function(u){var o=[r.of(u)];return n.forEach((function(n){return o.push(l(e,n,"on",a))})),r.merge.apply(void 0,i(o)).pipe(t.scan(y,[]))})),t.distinctUntilChanged())}function d(e,n){for(var r=e.length,t=0;t<r;t++)if(e[t].payload.key===n)return t;return-1}function y(e,n){var r=n.payload,t=(n.type,n.prevKey),a=n.key,u=d(e,a),s=function(e,n){if(o(n))return 0;var r=d(e,n);return-1===r?e.length:r+1}(e,t);switch(n.type){case"value":if(n.payload&&n.payload.exists()){var c=null;n.payload.forEach((function(n){var r={payload:n,type:"value",prevKey:c,key:n.key};return c=n.key,e=i(e,[r]),!1}))}return e;case"child_added":if(u>-1){var f=e[u-1];(f&&f.key||null)!=t&&(e=e.filter((function(e){return e.payload.key!==r.key}))).splice(s,0,n)}else{if(null==t)return i([n],e);(e=e.slice()).splice(s,0,n)}return e;case"child_removed":return e.filter((function(e){return e.payload.key!==r.key}));case"child_changed":return e.map((function(e){return e.payload.key===a?n:e}));case"child_moved":if(u>-1){var l=e.splice(u,1)[0];return(e=e.slice()).splice(s,0,l),e}return e;default:return e}}function h(e){return(o(e)||0===e.length)&&(e=["child_added","child_removed","child_changed","child_moved"]),e}function v(e,n,r){return p(e,n=h(n),r)}function g(e,n,t){var a=(n=h(n)).map((function(n){return l(e,n,"on",t)}));return r.merge.apply(void 0,i(a))}function b(e,n,r){return function(e,n,r){return function(e,n){return l(e,"value","on",n).pipe(t.map((function(e){var n;return e.payload.forEach((function(e){return n=e.key,!1})),{data:e,lastKeyToLoad:n}})))}(e,r).pipe(t.withLatestFrom(n),t.map((function(e){var n=u(e,2),r=n[0],t=n[1],a=r.lastKeyToLoad,i=t.map((function(e){return e.key}));return{actions:t,lastKeyToLoad:a,loadedKeys:i}})),t.skipWhile((function(e){return-1===e.loadedKeys.indexOf(e.lastKeyToLoad)})),t.map((function(e){return e.actions})))}(e,g(e,n).pipe(t.scan((function(e,n){return i(e,[n])}),[])),r)}function m(e,n){return function(r,t){return f(r,{stringCase:function(){return e.child(r)[n](t)},firebaseCase:function(){return r[n](t)},snapshotCase:function(){return r.ref[n](t)}})}}function k(e,n){var r,a=n.schedulers.outsideAngular;return{query:e,update:m(e.ref,"update"),set:m(e.ref,"set"),push:function(n){return e.ref.push(n)},remove:(r=e.ref,function(e){return e?f(e,{stringCase:function(){return r.child(e).remove()},firebaseCase:function(){return e.remove()},snapshotCase:function(){return e.ref.remove()}}):r.remove()}),snapshotChanges:function(r){return v(e,r,a).pipe(n.keepUnstableUntilFirst)},stateChanges:function(r){return g(e,r,a).pipe(n.keepUnstableUntilFirst)},auditTrail:function(r){return b(e,r,a).pipe(n.keepUnstableUntilFirst)},valueChanges:function(r){return v(e,r,a).pipe(t.map((function(e){return e.map((function(e){return e.payload.val()}))})),n.keepUnstableUntilFirst)}}}function j(e,n){return function(){return l(e,"value","on",n)}}var F=new n.InjectionToken("angularfire2.realtimeDatabaseURL"),U=function(){function e(e,n,r,t,u){this.schedulers=new a["ɵAngularFireSchedulers"](u),this.keepUnstableUntilFirst=a["ɵkeepUnstableUntilFirstFactory"](this.schedulers,t),this.database=u.runOutsideAngular((function(){return a["ɵfirebaseAppFactory"](e,u,n).database(r||void 0)}))}return e.prototype.list=function(e,n){var r=c(this.database,e),t=r;return n&&(t=n(r)),k(t,this)},e.prototype.object=function(e){var n,r,a=c(this.database,e);return r=this,{query:n=a,snapshotChanges:function(){return j(n,r.schedulers.outsideAngular)().pipe(r.keepUnstableUntilFirst)},update:function(e){return n.ref.update(e)},set:function(e){return n.ref.set(e)},remove:function(){return n.ref.remove()},valueChanges:function(){return j(n,r.schedulers.outsideAngular)().pipe(r.keepUnstableUntilFirst,t.map((function(e){return e.payload.exists()?e.payload.val():null})))}}},e.prototype.createPushId=function(){return this.database.ref().push().key},e.decorators=[{type:n.Injectable,args:[{providedIn:"any"}]}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:n.Inject,args:[a.FIREBASE_OPTIONS]}]},{type:void 0,decorators:[{type:n.Optional},{type:n.Inject,args:[a.FIREBASE_APP_NAME]}]},{type:void 0,decorators:[{type:n.Optional},{type:n.Inject,args:[F]}]},{type:Object,decorators:[{type:n.Inject,args:[n.PLATFORM_ID]}]},{type:n.NgZone}]},e.ɵprov=n["ɵɵdefineInjectable"]({factory:function(){return new e(n["ɵɵinject"](a.FIREBASE_OPTIONS),n["ɵɵinject"](a.FIREBASE_APP_NAME,8),n["ɵɵinject"](F,8),n["ɵɵinject"](n.PLATFORM_ID),n["ɵɵinject"](n.NgZone))},token:e,providedIn:"any"}),e}();var A=function(){function e(){}return e.decorators=[{type:n.NgModule,args:[{providers:[U]}]}],e}();e.AngularFireDatabase=U,e.AngularFireDatabaseModule=A,e.URL=F,e.auditTrail=b,e.createListReference=k,e.fromRef=l,e.listChanges=p,e.snapshotChanges=v,e.stateChanges=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-fire-database.umd.min.js.map