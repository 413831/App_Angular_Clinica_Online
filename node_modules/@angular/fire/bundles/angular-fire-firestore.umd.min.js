!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/fire"),require("@angular/common"),require("@firebase/app"),require("@firebase/firestore"),require("firebase/firestore")):"function"==typeof define&&define.amd?define("@angular/fire/firestore",["exports","@angular/core","rxjs","rxjs/operators","@angular/fire","@angular/common","@firebase/app","@firebase/firestore","firebase/firestore"],t):t(((e=e||self).angular=e.angular||{},e.angular.fire=e.angular.fire||{},e.angular.fire.firestore={}),e.ng.core,e.rxjs,e.rxjs.operators,e.angular.fire,e.ng.common,e.firebase,e.firestore)}(this,(function(e,t,r,n,i,o,s,u){"use strict";s=s&&s.hasOwnProperty("default")?s.default:s;var a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function c(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}function p(e,t){return function(e,t){return void 0===t&&(t=r.asyncScheduler),new r.Observable((function(r){var n;return null!=t?t.schedule((function(){n=e.onSnapshot(r)})):n=e.onSnapshot(r),function(){null!=n&&n()}}))}(e,t)}function l(e,t){return p(e,t).pipe(n.map((function(e){return{payload:e,type:"value"}})))}function d(e,t){return p(e,t).pipe(n.map((function(e){return{payload:e,type:"query"}})))}function h(e,t){return d(e,t).pipe(n.map((function(e){return e.payload.docChanges().map((function(e){return{type:e.type,payload:e}}))})))}function y(e,t,r){return d(e,r).pipe(n.map((function(e){return e.payload.docChanges()})),n.scan((function(e,r){return g(e,r,t)}),[]),n.map((function(e){return e.map((function(e){return{type:e.type,payload:e}}))})))}function g(e,t,r){return t.forEach((function(t){r.indexOf(t.type)>-1&&(e=v(e,t))})),e}function v(e,t){switch(t.type){case"added":e[t.newIndex]&&e[t.newIndex].doc.ref.isEqual(t.doc.ref)||e.splice(t.newIndex,0,t);break;case"modified":(null==e[t.oldIndex]||e[t.oldIndex].doc.ref.isEqual(t.doc.ref))&&(t.oldIndex!==t.newIndex?(e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t)):e.splice(t.newIndex,1,t));break;case"removed":e[t.oldIndex]&&e[t.oldIndex].doc.ref.isEqual(t.doc.ref)&&e.splice(t.oldIndex,1)}return e}function b(e){return e&&0!==e.length||(e=["added","removed","modified"]),e}var m=function(){function e(e,t,r){this.ref=e,this.query=t,this.afs=r}return e.prototype.stateChanges=function(e){return e&&0!==e.length?h(this.query,this.afs.schedulers.outsideAngular).pipe(n.map((function(t){return t.filter((function(t){return e.indexOf(t.type)>-1}))})),n.filter((function(e){return e.length>0})),this.afs.keepUnstableUntilFirst):h(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.auditTrail=function(e){return this.stateChanges(e).pipe(n.scan((function(e,t){return f(e,t)}),[]))},e.prototype.snapshotChanges=function(e){var t=b(e);return y(this.query,t,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.valueChanges=function(e){return void 0===e&&(e={}),d(this.query,this.afs.schedulers.outsideAngular).pipe(n.map((function(t){return t.payload.docs.map((function(t){var r;return e.idField?a(a({},t.data()),((r={})[e.idField]=t.id,r)):t.data()}))})),this.afs.keepUnstableUntilFirst)},e.prototype.get=function(e){return r.from(this.query.get(e)).pipe(n.observeOn(this.afs.schedulers.insideAngular))},e.prototype.add=function(e){return this.ref.add(e)},e.prototype.doc=function(e){return new I(this.ref.doc(e),this.afs)},e}();var I=function(){function e(e,t){this.ref=e,this.afs=t}return e.prototype.set=function(e,t){return this.ref.set(e,t)},e.prototype.update=function(e){return this.ref.update(e)},e.prototype.delete=function(){return this.ref.delete()},e.prototype.collection=function(e,t){var r=E(this.ref.collection(e),t),n=r.ref,i=r.query;return new m(n,i,this.afs)},e.prototype.snapshotChanges=function(){return l(this.ref,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.valueChanges=function(){return this.snapshotChanges().pipe(n.map((function(e){return e.payload.data()})))},e.prototype.get=function(e){return r.from(this.ref.get(e)).pipe(n.observeOn(this.afs.schedulers.insideAngular))},e}();var A=function(){function e(e,t){this.query=e,this.afs=t}return e.prototype.stateChanges=function(e){return e&&0!==e.length?h(this.query,this.afs.schedulers.outsideAngular).pipe(n.map((function(t){return t.filter((function(t){return e.indexOf(t.type)>-1}))})),n.filter((function(e){return e.length>0})),this.afs.keepUnstableUntilFirst):h(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.auditTrail=function(e){return this.stateChanges(e).pipe(n.scan((function(e,t){return f(e,t)}),[]))},e.prototype.snapshotChanges=function(e){var t=b(e);return y(this.query,t,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.valueChanges=function(){return d(this.query,this.afs.schedulers.outsideAngular).pipe(n.map((function(e){return e.payload.docs.map((function(e){return e.data()}))})),this.afs.keepUnstableUntilFirst)},e.prototype.get=function(e){return r.from(this.query.get(e)).pipe(n.observeOn(this.afs.schedulers.insideAngular))},e}();var F=new t.InjectionToken("angularfire2.enableFirestorePersistence"),j=new t.InjectionToken("angularfire2.firestore.persistenceSettings"),q=new t.InjectionToken("angularfire2.firestore.settings");function E(e,t){return void 0===t&&(t=function(e){return e}),{query:t(e),ref:e}}var x=function(){function e(e,t,n,a,c,f,p){var l=this;if(this.schedulers=new i["ɵAngularFireSchedulers"](f),this.keepUnstableUntilFirst=i["ɵkeepUnstableUntilFirstFactory"](this.schedulers,c),this.firestore=f.runOutsideAngular((function(){var r=i["ɵfirebaseAppFactory"](e,f,t);u.registerFirestore&&u.registerFirestore(s);var n=r.firestore();return a&&n.settings(a),n})),n&&!o.isPlatformServer(c)){this.persistenceEnabled$=f.runOutsideAngular((function(){try{return r.from(l.firestore.enablePersistence(p||void 0).then((function(){return!0}),(function(){return!1})))}catch(e){return r.of(!1)}}))}else this.persistenceEnabled$=r.of(!1)}return e.prototype.collection=function(e,t){var r=E("string"==typeof e?this.firestore.collection(e):e,t),n=r.ref,i=r.query;return new m(n,i,this)},e.prototype.collectionGroup=function(e,t){var r=t||function(e){return e},n=this.firestore.collectionGroup(e);return new A(r(n),this)},e.prototype.doc=function(e){var t;return t="string"==typeof e?this.firestore.doc(e):e,new I(t,this)},e.prototype.createId=function(){return this.firestore.collection("_").doc().id},e.decorators=[{type:t.Injectable,args:[{providedIn:"any"}]}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[i.FIREBASE_OPTIONS]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[i.FIREBASE_APP_NAME]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[F]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[q]}]},{type:Object,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:t.NgZone},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[j]}]}]},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e(t["ɵɵinject"](i.FIREBASE_OPTIONS),t["ɵɵinject"](i.FIREBASE_APP_NAME,8),t["ɵɵinject"](F,8),t["ɵɵinject"](q,8),t["ɵɵinject"](t.PLATFORM_ID),t["ɵɵinject"](t.NgZone),t["ɵɵinject"](j,8))},token:e,providedIn:"any"}),e}();var O=function(){function e(){}return e.enablePersistence=function(t){return{ngModule:e,providers:[{provide:F,useValue:!0},{provide:j,useValue:t}]}},e.decorators=[{type:t.NgModule,args:[{providers:[x]}]}],e}();e.AngularFirestore=x,e.AngularFirestoreCollection=m,e.AngularFirestoreCollectionGroup=A,e.AngularFirestoreDocument=I,e.AngularFirestoreModule=O,e.ENABLE_PERSISTENCE=F,e.PERSISTENCE_SETTINGS=j,e.SETTINGS=q,e.associateQuery=E,e.combineChange=v,e.combineChanges=g,e.docChanges=h,e.fromCollectionRef=d,e.fromDocRef=l,e.fromRef=p,e.sortedChanges=y,e.validateEventsArray=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-fire-firestore.umd.min.js.map